{
  "version": "3.0.0",
  "descripcion": "Configuración TarantulaHawk - LFPIORPI 2025",
  "ultima_actualizacion": "2025-01-24",
  "data": {
    "dataset_enriched_path": "uploads/enriched/dataset_enriched_with_anomalies.csv"
  },
  "lfpiorpi": {
    "uma_diaria": 113.14,
    "uma_mxn": 113.14,
    "vigencia_uma": "2025-02-01",
    "umbrales": {
      "_general": {
        "aviso_UMA": 645,
        "efectivo_max_UMA": 8025,
        "descripcion": "Umbral general para actividades no especificadas"
      },
      "I_juegos": {
        "aviso_UMA": 325,
        "efectivo_max_UMA": 645,
        "descripcion": "Juegos con apuesta, concursos o sorteos"
      },
      "II_tarjetas": {
        "aviso_UMA": 805,
        "efectivo_max_UMA": 805,
        "descripcion": "Emisión y comercialización de tarjetas"
      },
      "III_mutuo": {
        "aviso_UMA": 1605,
        "efectivo_max_UMA": 8025,
        "descripcion": "Operaciones de mutuo, garantía o préstamos"
      },
      "V_inmuebles": {
        "aviso_UMA": 8025,
        "efectivo_max_UMA": 8025,
        "descripcion": "Transmisión de derechos sobre inmuebles"
      },
      "VIII_vehiculos": {
        "aviso_UMA": 6420,
        "efectivo_max_UMA": 3210,
        "descripcion": "Comercialización de vehículos"
      },
      "IX_transmision": {
        "aviso_UMA": 645,
        "efectivo_max_UMA": 3210,
        "descripcion": "Transmisión de dinero o valores"
      },
      "X_traslado_valores": {
        "aviso_UMA": 3210,
        "efectivo_max_UMA": 3210,
        "descripcion": "Traslado o custodia de valores"
      },
      "XI_joyeria": {
        "aviso_UMA": 3210,
        "efectivo_max_UMA": 3210,
        "descripcion": "Joyas, metales preciosos, piedras preciosas"
      },
      "XII_arte": {
        "aviso_UMA": 4815,
        "efectivo_max_UMA": 4815,
        "descripcion": "Comercialización de obras de arte"
      },
      "XIV_fedatarios": {
        "aviso_UMA": 8025,
        "efectivo_max_UMA": 8025,
        "descripcion": "Servicios de fe pública (notarios)"
      },
      "XVI_activos_virtuales": {
        "aviso_UMA": 645,
        "efectivo_max_UMA": 645,
        "descripcion": "Servicios de activos virtuales"
      }
    },
    "actividad_a_fraccion": {
      "juegos_apuestas": "I_juegos",
      "casino": "I_juegos",
      "tarjetas": "II_tarjetas",
      "tarjetas_prepago": "II_tarjetas",
      "casa_cambio": "III_mutuo",
      "cambio_divisas": "III_mutuo",
      "prestamos": "III_mutuo",
      "inmobiliaria": "V_inmuebles",
      "inmuebles": "V_inmuebles",
      "bienes_raices": "V_inmuebles",
      "automotriz": "VIII_vehiculos",
      "vehiculos": "VIII_vehiculos",
      "transmision_dinero": "IX_transmision",
      "envio_dinero": "IX_transmision",
      "traslado_valores": "X_traslado_valores",
      "custodia_valores": "X_traslado_valores",
      "joyeria_metales": "XI_joyeria",
      "joyeria": "XI_joyeria",
      "metales_preciosos": "XI_joyeria",
      "piedras_preciosas": "XI_joyeria",
      "relojes": "XI_joyeria",
      "comercio_arte": "XII_arte",
      "arte_antiguedades": "XII_arte",
      "notaria": "XIV_fedatarios",
      "fedatarios": "XIV_fedatarios",
      "activos_virtuales": "XVI_activos_virtuales",
      "criptomonedas": "XVI_activos_virtuales",
      "servicios_financieros": "_general",
      "servicios_generales": "_general",
      "otro": "_general"
    },
    "actividad_alto_riesgo": [
      "XVI_activos_virtuales",
      "X_traslado_valores",
      "XI_joyeria",
      "casa_cambio",
      "transmision_dinero",
      "activos_virtuales",
      "criptomonedas",
      "traslado_valores",
      "cambio_divisas",
      "joyeria_metales"
    ]
  },
  "ebr": {
    "descripcion": "Enfoque Basado en Riesgos con ponderaciones específicas para PLD/FT",
    "version": "2.0",
    "umbrales_clasificacion": {
      "bajo_max": 50,
      "medio_max": 65,
      "descripcion": "0-50=bajo/relevante, 51-65=medio/inusual, 66-100=alto/preocupante"
    },
    "ponderaciones": {
      "efectivo": {
        "nombre": "Pago en Efectivo",
        "descripcion": "Operación realizada en efectivo (alto riesgo PLD)",
        "puntos": 25,
        "condicion": "EsEfectivo == 1",
        "categoria": "tipo_operacion"
      },
      "sector_alto_riesgo": {
        "nombre": "Sector de Alto Riesgo",
        "descripcion": "Actividad en sector vulnerable LFPIORPI",
        "puntos": 20,
        "condicion": "SectorAltoRiesgo == 1",
        "categoria": "perfil_cliente"
      },
      "acumulado_alto": {
        "nombre": "Acumulado 6M Elevado",
        "descripcion": "Monto acumulado en 6 meses supera umbral de monitoreo",
        "puntos": 15,
        "umbral_mxn": 500000,
        "condicion": "monto_6m >= 500000",
        "categoria": "comportamiento"
      },
      "internacional": {
        "nombre": "Operación Internacional",
        "descripcion": "Transferencia internacional (mayor escrutinio por riesgo transfronterizo)",
        "puntos": 10,
        "condicion": "EsInternacional == 1",
        "categoria": "tipo_operacion"
      },
      "ratio_alto": {
        "nombre": "Monto Atípico vs Perfil",
        "descripcion": "Monto significativamente superior al promedio histórico del cliente",
        "puntos": 10,
        "umbral_ratio": 3,
        "condicion": "ratio_vs_promedio > 3.0",
        "categoria": "comportamiento"
      },
      "frecuencia_alta": {
        "nombre": "Alta Frecuencia Operativa",
        "descripcion": "Cantidad de operaciones superior al patrón normal en 6 meses",
        "puntos": 10,
        "umbral_ops": 5,
        "condicion": "ops_6m > 5",
        "categoria": "comportamiento"
      },
      "nocturno": {
        "nombre": "Horario Nocturno",
        "descripcion": "Operación realizada entre 10PM y 6AM",
        "puntos": 5,
        "condicion": "es_nocturno == 1",
        "categoria": "patron_temporal"
      },
      "fin_semana": {
        "nombre": "Fin de Semana",
        "descripcion": "Operación en sábado o domingo",
        "puntos": 5,
        "condicion": "fin_de_semana == 1",
        "categoria": "patron_temporal"
      },
      "monto_redondo": {
        "nombre": "Monto Redondo Sospechoso",
        "descripcion": "Monto exactamente divisible por $10,000 (posible structuring)",
        "puntos": 5,
        "condicion": "es_monto_redondo == 1",
        "categoria": "comportamiento"
      },
      "burst": {
        "nombre": "Operaciones en Ráfaga",
        "descripcion": "Múltiples operaciones en menos de 1 hora (posible fraccionamiento)",
        "puntos": 5,
        "condicion": "posible_burst == 1",
        "categoria": "comportamiento"
      }
    },
    "categorias_peso": {
      "tipo_operacion": "Características de la operación",
      "perfil_cliente": "Perfil y sector del cliente",
      "comportamiento": "Patrones de comportamiento",
      "patron_temporal": "Patrones temporales"
    }
  },
  "validacion": {
    "campos_obligatorios": [
      "cliente_id",
      "monto",
      "fecha",
      "tipo_operacion"
    ],
    "campos_opcionales": [
      "sector_actividad",
      "hora",
      "id_transaccion"
    ],
    "tipos_operacion_validos": [
      "efectivo",
      "tarjeta",
      "transferencia_nacional",
      "transferencia_internacional",
      "cheque",
      "deposito",
      "retiro"
    ],
    "sector_default": "servicios_generales",
    "monto_minimo": 0.01,
    "monto_maximo": 999999999.99
  },
  "modelos": {
    "version": "2.0",
    "supervisado": {
      "archivo": "modelo_ensemble_stack.pkl",
      "tipo": "ensemble_stacking",
      "clases": [
        "relevante",
        "inusual",
        "preocupante"
      ]
    },
    "ensemble": {
      "use_stacking": true,
      "use_calibration": true,
      "calibration_method": "isotonic",
      "temporal_split": {
        "enabled": true,
        "months_test": 2,
        "months_val": 2
      },
      "test_size": 0.2,
      "cv_folds": 3,
      "threshold_preocupante": 0.51,
      "threshold_inusual": 0.45,
      "enable_shap": true
    },
    "no_supervisado": {
      "archivo": "no_supervisado_bundle.pkl",
      "tipo": "isolation_forest_dbscan",
      "version": "2.0",
      "k_min": 6,
      "k_max": 14,
      "target_outlier_ratio": 0.04,
      "top_n": 100,
      "iforest_n_estimators": 300,
      "analyze_all_classes": true,
      "export_anomaly_features": true,
      "enable_dbscan": true,
      "enable_pca_anomaly": true
    },
    "refuerzo": {
      "archivo": "modelo_refuerzo_th.pkl",
      "tipo": "q_learning",
      "version": "2.0",
      "grid_size": 17,
      "grid_min": 0.1,
      "grid_max": 0.9,
      "val_months": 2,
      "output_thresholds_json": true,
      "cost_weights": {
        "FN_preocupante": 50000,
        "FP_preocupante": 200,
        "FN_inusual": 5000,
        "FP_inusual": 50,
        "penalty_norma": 100000
      }
    },
    "drift_detection": {
      "enabled": true,
      "chi_square_threshold": 0.05,
      "alert_on_significant_drift": true
    },
    "explainability": {
      "shap_enabled": true,
      "shap_sample_size": 100,
      "top_n_features": 10
    }
  },
  "thresholds": {
    "ica_alta_confianza": 0.85,
    "ica_media_confianza": 0.6,
    "ica_baja_confianza": 0.4,
    "anomaly_score_alto": 0.7,
    "anomaly_score_medio": 0.5
  },
  "fusion": {
    "descripcion": "Reglas para fusionar ML + EBR + Guardrails",
    "reglas": {
      "guardrail_override": true,
      "ebr_puede_elevar": true,
      "ebr_puede_bajar": false,
      "requiere_revision_si_discrepancia": true
    },
    "elevacion_ebr": {
      "de_relevante_a_inusual_si_ebr_alto": true,
      "de_relevante_a_inusual_si_ebr_medio": true,
      "de_inusual_a_preocupante_si_ebr_alto": false
    }
  },
  "explicabilidad": {
    "max_razones": 3,
    "incluir_fundamento_legal": true,
    "incluir_articulo_fraccion": true,
    "incluir_umas": true,
    "generar_acciones_sugeridas": true,
    "plantillas_accion": {
      "preocupante": [
        "Generar Reporte de Operación Preocupante (ROP) para UIF",
        "Recopilar documentación soporte completa",
        "Notificar al oficial de cumplimiento en máximo 24 horas",
        "Evaluar necesidad de bloqueo preventivo de cuenta",
        "Documentar análisis y justificación de clasificación"
      ],
      "inusual": [
        "Documentar análisis detallado de la operación",
        "Solicitar información adicional al cliente si aplica",
        "Incluir cliente en monitoreo reforzado",
        "Revisar operaciones relacionadas en últimos 6 meses",
        "Actualizar perfil transaccional del cliente"
      ],
      "relevante": [
        "Mantener registro para trazabilidad",
        "Incluir en reportes periódicos de cumplimiento",
        "Continuar monitoreo estándar del cliente"
      ]
    }
  },
  "normativa": {
    "uma_mxn": 113.14,
    "ley_aplicable": "LFPIORPI",
    "articulo_actividades_vulnerables": 17,
    "articulo_avisos": 18,
    "plazo_aviso_dias_habiles": 15,
    "conservacion_documentos_años": 5,
    "fracciones_umbral_aviso_mxn": {
      "V_inmuebles": 8025,
      "VIII_vehiculos": 6420,
      "XI_joyeria": 3210,
      "X_traslado_valores": 3210,
      "XVI_activos_virtuales": 645
    },
    "fracciones_limite_efectivo_mxn": {
      "V_inmuebles": 8025,
      "VIII_vehiculos": 3210,
      "XI_joyeria": 3210,
      "X_traslado_valores": 3210,
      "XVI_activos_virtuales": 645
    }
  },
  "api": {
    "rate_limit_requests_per_minute": 60,
    "max_file_size_mb": 50,
    "max_transactions_per_file": 100000,
    "timeout_ml_seconds": 300
  }
}